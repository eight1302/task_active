 <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>积分明细</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="../../plugins/datatables/dataTables.bootstrap.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="../../dist/css/bootstrap-switch.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">
    <script type="text/javascript" src="../../../plugins/kindeditor/kindeditor.js"></script>
  <script charset="utf-8" src="../../../plugins/kindeditor/lang/zh_CN.js"></script>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">
    <!-- Logo -->
    <a href="../../index3.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>R</b>HM</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>润合美</b>村淘合伙人</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <div class="navbar-custom-menu">
      <ul class="nav navbar-nav">
       		<li><a href="javascript:void(0);" id="logout1" >退出</a></li>
       	</ul>
        <ul class="nav navbar-nav">
          <!-- Messages: style can be found in dropdown.less-->
          
          <!-- Notifications: style can be found in dropdown.less -->
          
          <!-- Tasks: style can be found in dropdown.less -->
          
          <!-- User Account: style can be found in dropdown.less -->
          
          <!-- Control Sidebar Toggle Button -->
          <li>
            <!-- <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a> -->
          </li>
        </ul>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <section class="sidebar"  id="menu_content" >
     
    </section>
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>积分管理<small>积分明细</small></h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
        <li><a href="#">积分管理</a></li>
        <li class="active">积分明细</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">

          <div class="box">
            <!-- <div class="box-header">
              <h3 class="box-title">Data Table With Full Features</h3>
            </div> -->
            <!-- /.box-header -->
            <div class="box-body">
            	<div class="row-fluid"  id="div-advanced-search">
                    <form class="form-inline well"  role="form">
						<div class="form-group" style="margin-right: 10px">
						    <label class="" for="name-search">姓名:</label>
						    <input type="text" class="form-control" id="name-search" placeholder="姓名">
						</div>
						<div class="form-group" style="margin-right: 10px">
						    <label class="" for="position-search">旺旺号:</label>
						    <input type="text" class="form-control" id="taobaocode-search" placeholder="旺旺号">
						</div>
						<div class="form-group" style="margin-right: 10px">
						    <label class="" for="office-search">手机号:</label>
						    <input type="text" class="form-control" id="phonenumber-search" placeholder="手机号">
						</div>
						<!-- <div class="form-group" style="margin-right: 10px">
						    <label class="" for="extn-search">收货地址:</label>
						    <input type="text" class="form-control" id="address-search" placeholder="收货地址">
						</div> -->
						<div class="form-group" style="margin-right: 10px">
						    <label class="" for="scoretype-search">积分类型:</label>
							<select class="input-small" id="scoretype-search" style="width:159px;height:34px;border:1px solid #d2d6de;">
								  <!-- <option value ="ALL">全部</option> -->
								  <option value ="SHARE">转发活动积分</option>
								  <option value="SIGNUP">签到积分</option>
								  <option value ="SHOPPING">购物积分</option>
								  <option value ="FEEDBACK">提建议积分</option>
								  <option value ="MARKET">组织推广活动积分</option>
								  <option value ="INVITEWECHAT">拉新人进群积分</option> 
								  <option value="CUSTOM">自定义积分</option>
							</select>
						</div>
						<div class="form-group" style="margin-right: 10px">
							<button type="button" class="btn" id="btn-advanced-search"><i class="fa fa-search"></i> 查询</button>
						</div>
                    </form>
                </div>
              <table id="example" class="table table-striped table-bordered">
			        <thead>
			        <tr>
			        	<th></th>
			            <th>ID</th>
			            <th>姓名</th>
			            <th>旺旺号</th>
			            <th>手机号</th>
			            <!-- <th>常用收货地址</th> -->
			            <th>积分类型</th>
			            <!-- <th>积分排名</th> -->
			            <th>获得积分</th>
			            <th>积分时间</th>
			            <!-- <th>积分总额</th>-->
			            <!-- <th>积分消费</th>-->
			            <th>操作</th>
			        </tr>
			        </thead>
			        <tbody></tbody>
			        <!-- tbody是必须的 -->
			    </table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  
  <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:700px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">添加积分记录</h4>
            </div>
            <div class="modal-body">
            	<div class="form-group" style="margin-right: 10px">
				    <label class="" for="scoretype-new">积分类型：</label> 
				    <select class="input-small" id="scoretype-new">
				    	<option value="INVITEWECHAT">拉新人进群积分</option>
						<option value="MARKET">组织推广活动积分</option>
						<option value="SHARE">转发活动积分</option><!-- TODO 控制显示选择活动的隐藏 -->
						<option value="CUSTOM">自定义</option>
					</select>
				</div>
				<div class="form-group" style="margin-right: 10px;display: none;" id="newscoretype-new-div" >
				    <label class="" for="scoretype-new">自定义积分备注：</label> 
				     <input type="text" class="form-control" id="newscoretype-new"   placeholder="自定义积分备注" >
				</div>
				<div class="form-group" style="margin-right: 10px;display: none;" id="newscore-new-div">
				    <label class="" for="scoretype-new">自定义积分数：</label> 
				     <input type="number" class="form-control" id="newscore-new"   placeholder="自定义积分数" >
				</div>
                <div id="taobaocode-div" class="form-group   has-feedback">
	                <!-- <label class="" for="position-search">选择会员</label>
	                <input type="text" class="form-control" id="taobaocode-new"   placeholder="旺旺号">
	                <span id="taobaocode-valid" style="display:none;" class="glyphicon glyphicon-ok form-control-feedback"></span> -->
	                <label class="" for="taobaocode-new">选择会员</label>
					<div class="input-group">
                        <input type="text" class="form-control" id="taobaocode-new">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            </ul>
                        </div>
                    </div>
                </div>
				<div class="form-group " id="activity-new-div" style="display:none;">
					<label class="" for="activity-new">选择活动</label>
					<div class="input-group">
                        <input type="text" class="form-control" id="activity-new">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            </ul>
                        </div>
                    </div>
				</div>
				<div class="form-group">
	                <label class="" for="position-search">时间</label>
	                <input type="date" class="form-control" id="scoretime-new"   placeholder="活动结束时间">
                </div>
                
                <div class="form-group">
                	<p id="feedback"></p>
                	<textarea rows="5"  style="width: 100%" placeholder="描述" id="content-new" ></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="save">保存</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModal2Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal2Label">导入积分记录</h4>
            </div>
            <div class="modal-body">
            	 <br>
                <div class="form-group">
                	<a href="../../template/template2.xls"  class="btn btn-primary">下载模板</a>
                </div>
                <br>
                <div class="form-group">
                    <input type="file" class="form-control" name="file" id="file-import2" placeholder=""  accept=".xls,.xlsx">
                </div>
                <div class="form-group" id="loadinggif2" style="text-align:center;display: none" >
                	<span >上传中<img src="../../dist/img/loading.gif" ></span>
                </div>
                <br><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="import2">保存</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModal3Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal3Label">导入拉新人进群记录</h4>
            </div>
            <div class="modal-body">
            	 <br>
                <div class="form-group">
                	<a href="../../template/template3.xls"  class="btn btn-primary">下载模板</a>
                </div>
                <br>
                <div class="form-group">
                    <input type="file" class="form-control" name="file" id="file-import3" placeholder=""  accept=".xls,.xlsx">
                </div>
                <div class="form-group" id="loadinggif3" style="text-align:center;display: none" >
                	<span >上传中<img src="../../dist/img/loading.gif" ></span>
                </div>
                <br><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="import3">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModal4Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal4Label">导入组织推广活动记录</h4>
            </div>
            <div class="modal-body">
            	 <br>
                <div class="form-group">
                	<a href="../../template/template2.xls"  class="btn btn-primary">下载模板</a>
                </div>
                <br>
                <div class="form-group">
                    <input type="file" class="form-control" name="file" id="file-import4" placeholder=""  accept=".xls,.xlsx">
                </div>
                <div class="form-group" id="loadinggif4" style="text-align:center;display: none" >
                	<span >上传中<img src="../../dist/img/loading.gif" ></span>
                </div>
                <br><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="import4">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal5" tabindex="-1" role="dialog" aria-labelledby="myModal5Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal5Label">导入转发活动记录</h4>
            </div>
            <div class="modal-body">
            	 <br>
                <div class="form-group">
                	<a href="../../template/template2.xls"  class="btn btn-primary">下载模板</a>
                </div>
                <br>
                <div class="form-group">
                    <input type="file" class="form-control" name="file" id="file-import5" placeholder=""  accept=".xls,.xlsx">
                </div>
                <div class="form-group" id="loadinggif5" style="text-align:center;display: none" >
                	<span >上传中<img src="../../dist/img/loading.gif" ></span>
                </div>
                <br><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="import5">保存</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModal6" tabindex="-1" role="dialog" aria-labelledby="myModal6Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModal6Label">导入平台奖励记录</h4>
            </div>
            <div class="modal-body">
            	 <br>
                <div class="form-group">
                	<a href="../../template/template2.xls"  class="btn btn-primary">下载模板</a>
                </div>
                <br>
                <div class="form-group">
                    <input type="file" class="form-control" name="file" id="file-import6" placeholder=""  accept=".xls,.xlsx">
                </div>
                <div class="form-group" id="loadinggif6" style="text-align:center;display: none" >
                	<span >上传中<img src="../../dist/img/loading.gif" ></span>
                </div>
                <br><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="import6">保存</button>
            </div>
        </div>
    </div>
</div>
  
  
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>Version</b> 0.0.1
    </div>
    <strong>Copyright &copy; 2016-2019 <a href="http://almsaeedstudio.com">润合美</a>.</strong> All rights reserved.
  </footer>

  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<script src="../../plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="../../plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<script src="../../dist/js/bootstrap-switch.min.js"></script>
<script src="../../plugins/handlebars-v3.0.1.js"></script>
<script src="../../dist/js/common.js"></script>
<script src="../../plugins/bootstrap-suggest-plugin/bootstrap-suggest.min.js"></script>
<script type="text/javascript" src="../../..//js/ajaxfileupload.js"></script>
<script src="../../dist/js/menu.js"></script>
<script type="text/javascript">
	var pagename= "scorerecord";
</script>
<!-- page script -->
<!--定义操作列按钮模板-->
<script id="tpl" type="text/x-handlebars-template">
    {{#each func}}
    <button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button>
    {{/each}}
</script>

<script>
    var table;
    var detailTable ;
    var detailID ;
    var detailname;
    var detailtaobaocode;
    var editFlag = false;
    $(function () {
        //$('#start_date').datetimepicker();
        
        KindEditor.ready(function(K) {
			window.editor = K.create("#content-new", {
				minWidth : '410px',
				height : '300px',
				resizeType : 0,
				uploadJson : context_path+'jsp/upload_json.jsp',
				fileManagerJson : context_path+'jsp/file_manager_json.jsp',
				allowFileManager : true
			});
		});
        
        var bsSuggest = $("input#taobaocode-new").bsSuggest({
            url: context_path+"admin/membermanage/usersuggestlist?searchKey=",
            data:{"searchKey":$("input#taobaocode-new").val()},
            getDataMethod: "url",
            idField:"id",
            showBtn: true,
            keyField: "taobaocode",
            effectiveFields: ["id","name","taobaocode","phonenumber"],
            effectiveFieldsAlias: {"id":"ID","name":"姓名","taobaocode":"旺旺号","phonenumber":"手机号"}
          });
        
        var bsSuggest = $("input#activity-new").bsSuggest({
            url: context_path+"admin/activitymanage/activitysuggestlist?searchKey=",
            data:{"searchKey":$("input#activity-new").val()},
            getDataMethod: "url",
            idField:"id",
            showBtn: true,
            keyField: "title",
            effectiveFields: ["id","title","summary"],
            effectiveFieldsAlias: {"id":"ID","title":"活动标题","summary":"活动简介"}
          });
        
        $("#scoretype-new").click(function(){
        	var new_type=$("#scoretype-new").val();
        	if(new_type=="CUSTOM"){
        		$("#newscore-new-div").show();
        		$("#newscoretype-new-div").show();
        		//newscore-new
        		//newscoretype-new
        	}else{
        		$("#newscore-new-div").hide();
        		$("#newscoretype-new-div").hide();
        		$("#newscore-new").val('');
        		$("#newscoretype-new").val('');
        	}
        	if(new_type=="SHARE" ){
        		$("#activity-new-div").show();
        	}else{
        		$("#activity-new-div").hide();
        	}
        })
        
        var tpl = $("#tpl").html();
        //预编译模板
        var template = Handlebars.compile(tpl);
        
        table = $('#example').DataTable({
            ajax: {
                url: context_path+"admin/scoremanage/scorerecordreviewlist",
                type: "POST",
                data: function(d){
                	  d.name = $('#name-search').val();
                	  d.taobaocode = $('#taobaocode-search').val();
                	  d.phonenumber = $('#phonenumber-search').val();
                	  d.scoretype = $('#scoretype-search').val();
                }
            },
            serverSide: true,
            searching: false ,   //禁用原生搜索
            order: [],          //取消默认排序查询,否则复选框一列会出现小箭头
            columns: [
				{ //复选框单元格
				    className: "td-checkbox",
				    orderable: false,
				    width: "30px",
				    data: null,
				    render: function (data, type, row, meta) {
				        return '<input type="checkbox" value='+row.id+' class="iCheck">';
				    }
				},
                {"data": "id",orderable: false},
                {"data": "name",orderable: false},
                {"data": "taobaocode",orderable: false},
                {"data": "phonenumber",orderable: false},
                //{"data": "address",orderable: false},
                {"data": "scoretypeStr",orderable: false},
                //{"data": "rank",orderable: false},
                {"data": "score",orderable: false},
                {"data": "scoretimeStr",orderable: false},
                //{"data": "totalscore",orderable: false},
               // {"data": "scoreused",orderable: false},
                {"data": null,orderable: false}
            ],
            columnDefs: [
                {
                    targets:8,
                    render: function (a, b, c, d) {//data, type, row, meta
                    	
                    	if(c.scoretype=="SHARE"){
                    		if(c.status=="0"){
                    			var context =
                                {
                                    func: [
                                        //{"name": "查看详情", "fn": "details(\'"+ c.id + "\')", "type": "primary"}
                                        //,
                                        {"name": "确认积分", "fn": "review(\'" + c.id + "\')", "type": "danger"}
                                    ]
                                };
                    		}else{
                    			return "";
                    		}
                             var html = template(context);
                             return html;
                    	}else{
                    		return "";
                    	}
                    }
                }  
            ],
            "language": {
                "lengthMenu": "每页 _MENU_ 条记录",
                "zeroRecords": "没有找到记录",
                "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                "infoEmpty": "无记录",
                "sSearch":  "<b>模糊搜索</b>：",
                "infoFiltered": "(从 _MAX_ 条记录过滤)",
                "paginate": {
                    "previous": "上一页",
                    "next": "下一页"
                },
           		"sEmptyTable":     "没有找到记录",
            	"sLoadingRecords": "载入中..."
            },
            "dom": "<'row'<'col-xs-2'l><'#mytool.col-xs-8'><'col-xs-6'f>r>" + "t" +"<'row'<'col-xs-6'i><'col-xs-6'p>>",
            initComplete: function () {
                
                $("#mytool").append('<button type="button" id="addButton1" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal" style="margin-right:5px">添加积分记录</button>');
                $("#mytool").append('<button id="importButton3" type="button" class="btn btn-primary btn-sm"  style="margin-right:5px">导入拉新人进群记录</button>&nbsp');
                //$("#mytool").append('<button id="importButton4" type="button" class="btn btn-primary btn-sm"  style="margin-right:5px">导入组织推广活动记录</button>&nbsp');
                //$("#mytool").append('<button id="importButton5" type="button" class="btn btn-primary btn-sm"  style="margin-right:5px">导入转发活动记录</button>&nbsp');
                //$("#mytool").append('<button id="importButton6" type="button" class="btn btn-primary btn-sm"  style="margin-right:5px">导入平台奖励记录</button>&nbsp');


                //$("#datainit").on("click", initData);
                $("#addButton").click(function(){
                	editFlag=false;
                	$("#myModalLabel").html("新增");
                	$("#id").val("");
                	$("#name").val("");
                    $("#taobaocode").val("");
                    $("#phonenumber").val("");
                    $("#groupstatus").val("");
                    $("#status").val("");
                });
                $("#importButton3").click(function(){
                	$("#myModal3").modal("show");
                })
                $("#importButton4").click(function(){
                	$("#myModal4").modal("show");
                })
                $("#importButton5").click(function(){
                	$("#myModal5").modal("show");
                })
                $("#importButton6").click(function(){
                	$("#myModal6").modal("show");
                })
                $("#import3").click(function(){
                   	if($("#file-import3").val()){
                   		$("#loadinggif3").show();
               			$.ajaxFileUpload({
               				url :context_path+'admin/membermanage/importInviterecords',
               				secureuri : false,
               				type:"POST",
               				data: {fileName:encodeURI($("#file-import3").val())}, 
               				fileElementId : 'file-import3',
               				dataType : 'json',
               				success : function(data, status) {
               					console.log("data:"+data);
               					//imgurlnew=data.data;
               					alert("上传成功");
               					//$("#file-import").val("");
               					$("#myModal3").modal("hide");
               					$("#loadinggif3").hide();
               					table.ajax.reload(null,false)
               				},
               				error : function(data, status, e) {
               					alert("上传异常");
               					$("#loadinggif3").hide();
               				}
               			});
               		}else{
               			alert("请选择文件");
               		}
                })
            }
        });
        $("#save").click(add);
        //$("#taobaocode-new").change(validtaobaocode);
        
        $("#btn-advanced-search").click(function(){
        	table.ajax.reload();
        })
    });
    

    function review(id){
    	var flag = confirm("确定要积分吗?")
    	if(flag){
    		$.post(context_path+"admin/scoremanage/scorerecordreview",{id,id},function(data){
    			//if(data.data){
    				table.ajax.reload(null,false);
    			//}
    		})
    	}
    }
    
    
    
    function initDetailTable(){
    	if(!detailTable){
    		detailTable =$('#example2').DataTable({
            	ajax: {
                    url: context_path+"admin/scoremanage/scorerecordlist",
                    type: "POST",
                    data: function(d){
                    	  d.userid=detailID; 
                    }
                },
            	 serverSide: true,
                 searching: false ,   //禁用原生搜索
                 order: [],          //取消默认排序查询,否则复选框一列会出现小箭头
                 columns: [{"data": null,orderable: false,render:function(){return detailname}}, {"data": null,orderable: false,render:function(){return detailtaobaocode}},{"data": "scoretypeStr",orderable: false}, {"data": "score",orderable: false},{"data": "scoretimeStr",orderable: false}],
                 "language": {
                     "lengthMenu": "每页 _MENU_ 条记录",
                     "zeroRecords": "没有找到记录",
                     "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                     "infoEmpty": "无记录",
                     "sSearch":  "<b>模糊搜索</b>：",
                     "infoFiltered": "(从 _MAX_ 条记录过滤)",
                     "paginate": {
                         "previous": "上一页",
                         "next": "下一页"
                     },
                		"sEmptyTable":     "没有找到记录",
                 	"sLoadingRecords": "载入中..."
                 }
            });
    	}else{
    		detailTable.ajax.reload();
    	}
    }

    /**
     * 清除
     */
    function clear() {
        $("#name").val("").attr("disabled",false);
        $("#position").val("");
        $("#salary").val("");
        $("#start_date").val("");
        $("#office").val("");
        $("#extn").val("");
        editFlag = false;
    }
    //<span class="glyphicon glyphicon-ok form-control-feedback"></span>
    //<span class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
    function validtaobaocode(){
    	var taobaocode = $.trim($("#taobaocode-new").val());;
    	if(taobaocode!=null && taobaocode!=""){
    		$.post(context_path+"admin/membermanage/validTaobaocode",{taobaocode:taobaocode},function(data){
    			data=$.parseJSON(data);
    			if(data.data){
    				$("#taobaocode-valid").addClass("glyphicon-ok").removeClass("glyphicon-warning-sign").show();
    				$("#taobaocode-div").addClass(" has-success").removeClass("has-warning");
    			}else{
    				$("#taobaocode-div").removeClass(" has-success").addClass("has-warning");
    				$("#taobaocode-valid").addClass("glyphicon-warning-sign").removeClass("glyphicon-ok").show();
    				alert("旺旺号未关联微信");
    			}
    		})
    	}
    }
    
    function validtaobaocodecallback(callback){
    	callback();
    	/*var taobaocode = $.trim($("#taobaocode-new").val());
    	if(taobaocode!=null && taobaocode!=""){
    		$.post(context_path+"admin/membermanage/validTaobaocode",{taobaocode:taobaocode},function(data){
    			data=$.parseJSON(data);
    			if(data.data){
    				$("#taobaocode-valid").addClass("glyphicon-ok").removeClass("glyphicon-warning-sign").show();
    				$("#taobaocode-div").addClass(" has-success").removeClass("has-warning");
    				if(callback){
    					callback();
    				}
    			}else{
    				$("#taobaocode-div").removeClass(" has-success").addClass("has-warning");
    				$("#taobaocode-valid").addClass("glyphicon-warning-sign").removeClass("glyphicon-ok").show();
    				alert("旺旺号未关联微信");
    			}
    		})
    	}*/
    }
    
    /**
     * 
     **/
    function add() {
    	validtaobaocodecallback(function(){
    		editor.sync();
    		var scoretype = $("#scoretype-new").val();//积分类型
    		var content= editor.html();//描述内容
    		var userid= $("#taobaocode-new").attr("data-id");//用户ID
    		var taobaocode= $("#taobaocode-new").val();//旺旺号
    		var activitytitle=$("#activity-new").val();//活动标题
    		var activityid=$("#activity-new").attr("data-id");//活动ID
    		var scoretime= $("#scoretime-new").val();//时间
    		var newscoretype=$("#newscoretype-new").val();//自定义积分备注
    		var newscore=$("#newscore-new").val();//自定义积分金额
    		
    		if(taobaocode==null  || $.trim(taobaocode)==""){
				alert("会员不能为空");
				return false;
			}
    		if(scoretime==null  || $.trim(scoretime)==""){
				alert("积分时间不能为空");
				return false;
			}
    		if(userid==null  || $.trim(userid)==""){
				alert("会员不能为空");
				return false;
			}
    		if(scoretype=="CUSTOM"){
    			if(newscore==null || $.trim(newscore)==""){
    				alert("自定义积分数不能为空");
    				return false;
    			}
    		}
    		if(scoretype=="SHARE"){
    			if(activityid==null  || $.trim(activityid)==""){
    				alert("活动不能为空");
    				return false;
    			}
    			if(activitytitle==null  || $.trim(activitytitle)==""){
    				alert("活动不能为空");
    				return false;
    			}
    		}
    		
    		$.post(context_path+"admin/scoremanage/addscorerecord",
    		    {scoretype:scoretype,//积分类型
    			content:content,//描述内容
    			userid:userid,//用户ID
    			taobaocode:taobaocode,//旺旺号
    			sharetitle:activitytitle,//活动标题
    			activityid:activityid,//活动ID
    			scoretime:scoretime,//时间
    			customScoreremark:newscoretype,//自定义积分备注
    			customScorenum:newscore//自定义积分金额
    		    }
    		,function(data){
    			console.log(data);
    			data=$.parseJSON(data);
    			if(data.data){
    				table.ajax.reload();
                    $("#myModal").modal("hide");
                    //$("#scoretype-new").val("")
                    $("#taobaocode-new").val('');
                    editor.html('');
                    $("#scoretime-new").val('');
    			}else{
    				alert("出错了");
    			}
    		})
    	})
    }

   
    /**
     * 积分记录
     **/
    function details(id,name,taobaocode) {
    	detailID = id;
    	detailname = name;
    	detailtaobaocode =taobaocode;
    	initDetailTable();
    	//detailTable.ajax.reload();
        //console.log(name);
        //editFlag = true;
       /* $("#myModalLabel").text("修改");
        $("#id").val(id);
        $("#name").val(name);//.attr("disabled",true);
        $("#taobaocode").val(taobaocode);
        $("#phonenumber").val(phonenumber);
        $("#address").val(address);
        $("#groupstatus").val(groupstatus);
        $("#status").val(status);*/
        $("#myModal").modal("show");
    }
</script>
</body>
</html>




